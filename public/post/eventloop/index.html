<!DOCTYPE html>
<html lang="en-us" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="nanpangyou" />
	
	
	
	<title>eventloop â™¡ ç”·èƒ–å‹deéƒ¨è½æ ¼</title>
	
    
    
    <meta name="description" content="Eventloop å…³äºEventloopï¼Œå¤§æ¦‚å¯ä»¥ç†è§£ä¸ºä¸€ç§æ“ä½œç³»ç»Ÿçš„è¿è¡Œæœºåˆ¶ã€‚JSä½¿ç”¨çš„å°±æ˜¯è¿™ç§è¿è¡Œæœºåˆ¶æ¥è§£å†³å•çº¿ç¨‹è¿è¡Œå¸¦æ¥çš„ä¸€äº›é—®é¢˜ã€‚
Wikiçš„å®šä¹‰å¦‚ä¸‹
 &amp;ldquo;Event Loopæ˜¯ä¸€ä¸ªç¨‹åºç»“æ„ï¼Œç”¨äºç­‰å¾…å’Œå‘é€æ¶ˆæ¯å’Œäº‹ä»¶ã€‚ï¼ˆa programming construct that waits for and dispatches events or messages in a program.ï¼‰&amp;rdquo;
 æœ‰å…³Eventloopçš„è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒNodeçš„å®˜æ–¹æ–‡æ¡£ã€‚
è¿™é‡Œä¸»è¦æ˜¯å°±å¸¸è§çš„é¢˜ç›®æ¥è¿›è¡Œæ€»ç»“ã€‚
 Eventloopä¸»è¦æœ‰6ä¸ªé˜¶æ®µ
 timers I/O callbacks idle prepare poll check close callbacks  ç‰¢è®°ä»¥ä¸‹çš„ä¸‰ä¸ªä¸åŒé˜¶æ®µ
 timersé˜¶æ®µ pollé˜¶æ®µ checké˜¶æ®µ  ä¸ä¹‹å¯¹åº”çš„æœ‰ä¸‰ä¸ªå¸¸è§çš„API
 setTimeout setImmediate nextTick  å…¶ä¸­ setTimeout ä¼šåœ¨timersé˜¶æ®µæ‰§è¡Œ setImmediate ä¼šåœ¨checké˜¶æ®µæ‰§è¡Œ nextTick ä¼šåœ¨æ¯ä¸ªé˜¶æ®µç»“æŸåç«‹åˆ»æ‰§è¡Œ
ä¸¾ä¸ªğŸŒ°
setImmediate(()=&amp;gt;{ console.log(&#39;setImmediate1&#39;) setTimeout(()=&amp;gt;{ console.log(&#39;setTimeout1&#39;) },0) }) setTimeout(()=&amp;gt;{ console.log(&#39;setTimeout2&#39;) setImmediate(()=&amp;gt;{ console.log(&#39;setImmediate2&#39;) }) },0) åœ¨è¿™ä¸ªğŸŒ°ä¸­ æœ€å¤–å±‚æœ‰ä¸¤ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«ä¸ºsetImmediateå’ŒsetTimeoutã€‚æ¯ä¸ªå‡½æ•°å†…éƒ¨åˆæœ‰ä¸€ä¸ªä¸ä¹‹ä¸åŒçš„å‡½æ•°
  å…ˆæ‰§è¡Œæœ€å¤–å±‚" />
    

    

	
    
    <link rel="shortcut icon" href="https://nanpangyou.github.io/images/favicon.png" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" media="screen" href="https://nanpangyou.github.io/css/normalize.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.0.0/build/styles/base16/github.min.css">
    <link href="https://nanpangyou.github.io/css/fancybox.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" media="screen" href="https://nanpangyou.github.io/css/captain.css" />

    
    
</head>

<body>
    <div class="main animate__animated animate__fadeInDown">
        <div class="nav_container animated fadeInDown">
    <div class="site_nav" id="site_nav">
        <ul>
            
        </ul>
    </div>
    <div class="menu_icon">
        <a id="menu_icon"><i class="ri-menu-line"></i></a>
    </div>
</div>
        <div class="header animated fadeInDown">
  <div class="site_title_container">
    <div class="site_title">
      <h1>
        <a href="https://nanpangyou.github.io/"> </a>
      </h1>
    </div>
    <div class="description">
      <p class="sub_title">
        
      </p>
      <div class="my_socials">
        
        <a
          href="https://nanpangyou.github.io/index.xml"
          type="application/rss+xml"
          title="rss"
          target="_blank"
          ><i class="ri-rss-fill"></i
        ></a>
      </div>
    </div>
  </div>
</div>

        <div class="content">
            <div class="single_page post_page">
                <div class="post animate__animated animate__fadeInDown">
                    <div class="post_title post_detail_title">
                        <h2>eventloop</h2>
                        <div class="date">Updated&nbsp;on&nbsp;2020.11.13</div>
                    </div>
                    <div class="post_content markdown">
                        <h1 id="eventloop">Eventloop</h1>
<p>å…³äº<code>Eventloop</code>ï¼Œå¤§æ¦‚å¯ä»¥ç†è§£ä¸ºä¸€ç§æ“ä½œç³»ç»Ÿçš„è¿è¡Œæœºåˆ¶ã€‚JSä½¿ç”¨çš„å°±æ˜¯è¿™ç§è¿è¡Œæœºåˆ¶æ¥è§£å†³å•çº¿ç¨‹è¿è¡Œå¸¦æ¥çš„ä¸€äº›é—®é¢˜ã€‚</p>
<p>Wikiçš„å®šä¹‰å¦‚ä¸‹</p>
<blockquote>
<p>&ldquo;Event Loopæ˜¯ä¸€ä¸ªç¨‹åºç»“æ„ï¼Œç”¨äºç­‰å¾…å’Œå‘é€æ¶ˆæ¯å’Œäº‹ä»¶ã€‚ï¼ˆa programming construct that waits for and dispatches events or messages in a program.ï¼‰&rdquo;</p>
</blockquote>
<p>æœ‰å…³<code>Eventloop</code>çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒNodeçš„å®˜æ–¹æ–‡æ¡£ã€‚</p>
<p>è¿™é‡Œä¸»è¦æ˜¯å°±å¸¸è§çš„é¢˜ç›®æ¥è¿›è¡Œæ€»ç»“ã€‚</p>
<hr>
<p>Eventloopä¸»è¦æœ‰6ä¸ªé˜¶æ®µ</p>
<ul>
<li>timers</li>
<li>I/O callbacks</li>
<li>idle prepare</li>
<li>poll</li>
<li>check</li>
<li>close callbacks</li>
</ul>
<p><strong>ç‰¢è®°ä»¥ä¸‹çš„ä¸‰ä¸ªä¸åŒé˜¶æ®µ</strong></p>
<ul>
<li>timersé˜¶æ®µ</li>
<li>pollé˜¶æ®µ</li>
<li>checké˜¶æ®µ</li>
</ul>
<p>ä¸ä¹‹å¯¹åº”çš„æœ‰ä¸‰ä¸ªå¸¸è§çš„API</p>
<ul>
<li>setTimeout</li>
<li>setImmediate</li>
<li>nextTick</li>
</ul>
<p>å…¶ä¸­
setTimeout ä¼šåœ¨timersé˜¶æ®µæ‰§è¡Œ
setImmediate ä¼šåœ¨checké˜¶æ®µæ‰§è¡Œ
nextTick ä¼šåœ¨æ¯ä¸ªé˜¶æ®µç»“æŸåç«‹åˆ»æ‰§è¡Œ</p>
<p>ä¸¾ä¸ªğŸŒ°</p>
<pre tabindex="0"><code>setImmediate(()=&gt;{
    console.log('setImmediate1')
    setTimeout(()=&gt;{
        console.log('setTimeout1')
    },0)
})

setTimeout(()=&gt;{
    console.log('setTimeout2')
    setImmediate(()=&gt;{
        console.log('setImmediate2')
    })
},0)
</code></pre><p>åœ¨è¿™ä¸ªğŸŒ°ä¸­
æœ€å¤–å±‚æœ‰ä¸¤ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«ä¸ºsetImmediateå’ŒsetTimeoutã€‚æ¯ä¸ªå‡½æ•°å†…éƒ¨åˆæœ‰ä¸€ä¸ªä¸ä¹‹ä¸åŒçš„å‡½æ•°</p>
<ol>
<li>
<p>å…ˆæ‰§è¡Œæœ€å¤–å±‚</p>
<blockquote>
<p>setImmediateå°†å‡½æ•°ä½“(fn1)å†…éƒ¨çš„éƒ¨åˆ†æ”¾å…¥checké˜¶æ®µã€‚setTimeoutå°†å‡½æ•°ä½“(fn2)å†…éƒ¨çš„éƒ¨åˆ†æ”¾å…¥timersé˜¶æ®µã€‚</p>
</blockquote>
</li>
<li>
<p>eventloopç”±pollé˜¶æ®µæ‰§è¡Œåˆ°checké˜¶æ®µ</p>
<blockquote>
<p>eventloopç”±pollé˜¶æ®µæ‰§è¡Œåˆ°checké˜¶æ®µåå‘ç°fn1ï¼Œæ‰§è¡Œfn1ã€‚å…ˆè¾“å‡º&rsquo;setImmediate1'ï¼Œç„¶åæ‰§è¡Œfn1å†…éƒ¨çš„setTimeout(fn3)ï¼Œå°†fn3çš„å‡½æ•°ä½“æ”¾å…¥timersé˜¶æ®µã€‚</p>
</blockquote>
</li>
<li>
<p>eventloopç”±checké˜¶æ®µæ‰§è¡Œåˆ°timersé˜¶æ®µ</p>
<blockquote>
<p>eventloopç”±checké˜¶æ®µæ‰§è¡Œåˆ°timersé˜¶æ®µå‘ç°fn2ï¼Œfn3ã€‚å…ˆæ‰§è¡Œfn2ï¼Œè¾“å‡ºâ€˜setTimeout2â€™ç„¶åå°†fn2å†…éƒ¨çš„setImmediate(fn4)æ”¾å…¥checké˜¶æ®µï¼Œç»§ç»­æ‰§è¡Œfn3ï¼Œè¾“å‡ºâ€˜setTimeout1â€™</p>
</blockquote>
</li>
<li>
<p>eventloopç”±timersé˜¶æ®µæ‰§è¡Œåˆ°pollé˜¶æ®µå†åˆ°checké˜¶æ®µ</p>
<blockquote>
<p>å‘ç°æœ‰fn4ï¼Œæ‰§è¡Œåè¾“å‡º&rsquo;setImmediate2'</p>
</blockquote>
</li>
</ol>
<p>æ‰€ä»¥ç»“æœä¸ºsetImmediate1-&gt;setTimeout2-&gt;setTimeout1-&gt;setImmediate2</p>
<h1 id="æµè§ˆå™¨ä¸­çš„eventloop">æµè§ˆå™¨ä¸­çš„eventloop</h1>
<p>æµè§ˆå™¨ä¸­æ²¡æœ‰setImmediateå’ŒnextTick</p>
<p>ä¸€èˆ¬å°†æµè§ˆå™¨ä¸­çš„è°ƒåº¦åˆ†ä¸º<code>å®ä»»åŠ¡</code>å’Œ<code>å¾®ä»»åŠ¡</code></p>
<p>ä¸€èˆ¬å¯ä»¥è¿™æ ·ç†è§£ã€‚</p>
<p>å®ä»»åŠ¡å°±æ˜¯å¯ä»¥ä¸€ä¼šåšçš„ä»»åŠ¡ï¼Œå¾®ä»»åŠ¡å°±æ˜¯è¦é©¬ä¸Šåšçš„ä»»åŠ¡</p>
<p><strong>å¸¸è§çš„æµè§ˆå™¨å¼‚æ­¥ä¸­ï¼ˆsetTimeoutï¼ŒsetIntervalï¼Œpromiseï¼‰åªæœ‰promise.then(fn)åé¢çš„fnå±äºå¾®ä»»åŠ¡ï¼Œè¦ç«‹é©¬æ‰§è¡Œï¼Œå…¶ä»–å‡ä¸ºå®ä»»åŠ¡</strong></p>
<p>å¦‚æœè§åˆ°awaitï¼Œå¯ä»¥å°†awaitæ”¹å†™ä¸ºpromiseå³å¯åˆ¤æ–­ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯:<strong>new Promiseï¼ˆfnï¼‰åé¢çš„å‡½æ•°fnæ˜¯ç«‹å³æ‰§è¡Œçš„</strong></p>
<p>ä¸¾ä¸ªğŸŒ°</p>
<pre tabindex="0"><code>async function async1(){
    console.log(1)
    await async2();
    console.log(2)
}

async function async2(){
    console.log(3)
}

async1()

new Promise(function(resolve){
    console.log(4)
    resolve()
}).then(function(){
    console.log(5)
})
</code></pre><p>åœ¨è¿™ä¸ªğŸŒ°ä¸­</p>
<ol>
<li>
<p>å£°æ˜äº†ä¸¤ä¸ªasyncå‡½æ•°ã€‚æ‰§è¡Œasync1</p>
<blockquote>
<p>å…ˆè¾“å‡ºconsole.log(1)ã€‚ç„¶åå°†await async2()ä»¥åŠåé¢çš„éƒ¨åˆ†æ”¹å†™ä¸º async2().then(console.log(2)).è¿™æ—¶å…ˆæ‰§è¡Œasync2å‡½æ•°ï¼Œè¾“å‡ºconsole.log(3).ç„¶åå°†thenåé¢çš„å‡½æ•°æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—</p>
</blockquote>
</li>
<li>
<p>ç»§ç»­æ‰§è¡Œåé¢çš„å‡½æ•°</p>
<blockquote>
<p>new Promiseå†…éƒ¨çš„å‡½æ•°ä¼šç«‹å³æ‰§è¡Œã€‚æ‰€ä»¥æ¥ç€è¾“å‡ºconsole.log(4)ï¼Œç„¶åæ‰§è¡Œresolveå›è°ƒã€‚å°†Promiseåé¢çš„thenå‡½æ•°æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—</p>
</blockquote>
</li>
<li>
<p>æ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—</p>
<blockquote>
<p>æŒ‰ç…§é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚å…ˆè¾“å‡ºconsole.log(2).ç„¶åè¾“å‡ºconsole.log(5)</p>
</blockquote>
</li>
</ol>
<p>æœ€åçš„ç»“æœï¼š1-&gt;3-&gt;4-&gt;2-&gt;5</p>

                    </div>
                    <div class="post_footer">
                        

                        <div class="single_page_divider"></div>

                        <div class="single_page_pagination">
                            
                                <a class="single_page_pagination_pre" href="https://nanpangyou.github.io/post/%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BAvue%E5%AE%9E%E4%BE%8B/">
                                    <i class="ri-arrow-left-s-line"></i>
                                    <span class="prev_title">åŠ¨æ€åˆ›å»ºvueå®ä¾‹</span>
                                    <span class="prev_text">Prev</span>
                                </a>
                            
                            
                                <a class="single_page_pagination_next" href="https://nanpangyou.github.io/post/%E8%A6%86%E7%9B%96antdv%E7%9A%84%E9%BB%98%E8%AE%A4%E6%A0%B7%E5%BC%8F/">
                                    <span class="next_title">è¦†ç›–antdvçš„é»˜è®¤æ ·å¼</span>
                                    <span class="next_text">Next</span>
                                    <i class="ri-arrow-right-s-line"></i>
                                </a>
                            
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <a id="back_to_top" href="#" class="back_to_top"><i class="ri-arrow-up-s-line"></i></a>
    <footer class="footer">
    <div class="powered_by">
        <a href="http://www.gohugo.io/">Published by Hugo,</a>
        <a href="https://github.com/CaptainOfPhB">Hosted on GitHub</a>
    </div>

    <div class="footer_slogan">
        <span></span>
    </div>
</footer>
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.0.0/build/highlight.min.js"></script>
<script src="https://nanpangyou.github.io/js/jquery-3.5.1.min.js"></script>
<script src="https://nanpangyou.github.io/js/fancybox.min.js"></script>
<script src="https://nanpangyou.github.io/js/captain.js"></script>

<script>
  hljs.highlightAll();
</script>

<script>
  var tables = document.getElementsByTagName('table');
  if(tables.length) {
    for(var i = 0; i < tables.length; i++) {
      tables[i].outerHTML = '<div style="overflow-x: auto">' + tables[i].outerHTML + '</div>'; 
    }
  }
</script>


</body>

</html>